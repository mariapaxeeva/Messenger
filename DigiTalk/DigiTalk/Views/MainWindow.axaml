<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:DigiTalk.Converters"
		xmlns:behaviors="clr-namespace:DigiTalk.Behaviors"
		xmlns:vm="using:DigiTalk.ViewModels"
		Icon="/Assets/icons/logo.ico"
		mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="DigiTalk.Views.MainWindow"
		Title="DigiTalk"
		x:Name="_MainWindow"
        MinWidth="600" MinHeight="450">
	<Window.Resources>
		<conv:MessageBackgroundConverter x:Key="MessageBackgroundConverter"/>
		<conv:MessageAlignmentConverter x:Key="MessageAlignmentConverter"/>
		<conv:SenderColorConverter x:Key="SenderColorConverter"/>
	</Window.Resources>
	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Заголовок -->
		<Border Grid.Row="0" Background="#a37ddb" Padding="10">
			<TextBlock Text="DigiTalk" FontSize="20" Foreground="White"
                       HorizontalAlignment="Center"/>
		</Border>

		<!-- Основное содержимое -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="200"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<!-- Список контактов -->
			<StackPanel Grid.Column="0" Background="#f5f5f5">
				<StackPanel Orientation="Horizontal">
					<Button Content="Log In" Margin="5" Command="{Binding LoginCommand}"
						    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
							IsEnabled="{Binding !IsAuthenticated}"/>
					<Button Content="Log Out" Command="{Binding Disconnect}" IsEnabled="{Binding IsAuthenticated}"/>
					<Button Content="Group" Command="{Binding CreateGroupCommand}" IsEnabled="{Binding IsAuthenticated}"/>
				</StackPanel>
				<ScrollViewer VerticalScrollBarVisibility="Visible" Height="350">
					<ListBox ItemsSource="{Binding Contacts}" SelectedItem="{Binding SelectedContact}">
						<ListBox.ItemTemplate>
							<DataTemplate>
								<StackPanel Orientation="Horizontal">
									<StackPanel.ContextMenu>
										<ContextMenu>
											<MenuItem Header="Invite member"
													  Command="{Binding #_MainWindow.DataContext.InviteToGroupCommand}"
													  IsVisible="{Binding IsGroup}"/>
											<MenuItem Header="Leave group"
													  Command="{Binding #_MainWindow.DataContext.LeaveGroupCommand}"
													  IsVisible="{Binding IsGroup}"/>
										</ContextMenu>
									</StackPanel.ContextMenu>
									<Ellipse Width="10" Height="10" Fill="#a37ddb"
											 VerticalAlignment="Center" Margin="0,0,5,0"/>
									<TextBlock Text="{Binding Name}" />
								</StackPanel>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</ScrollViewer>
			</StackPanel>

			<!-- Чат -->
			<Grid Grid.Column="1">
				<Grid.RowDefinitions>
					<RowDefinition Height="*"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>
				
				<Image Source="/Assets/backgrounds/chat-background.png"
						   Stretch="UniformToFill"
						   Opacity="0.5"/>
				
				<!-- Сообщения -->
				<ScrollViewer behaviors:ScrollViewerBehavior.AutoScroll="True"
					x:Name="MessagesScrollViewer" Grid.Row="0" VerticalScrollBarVisibility="Auto">
					<ItemsControl ItemsSource="{Binding Messages}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Margin="5" CornerRadius="5"
                                        Background="{Binding IsOwnMessage, Converter={StaticResource MessageBackgroundConverter}}"
                                        Padding="10" HorizontalAlignment="{Binding IsOwnMessage, Converter={StaticResource MessageAlignmentConverter}}">
									<Border.ContextMenu>
										<ContextMenu>
											<MenuItem Header="Delete for me"
													  Command="{Binding #_MainWindow.DataContext.DeleteForMeCommand}"
													  CommandParameter="{Binding}"
													  IsVisible="{Binding IsOwnMessage}"/>
											<MenuItem Header="Delete for everyone"
													  Command="{Binding #_MainWindow.DataContext.DeleteForEveryoneCommand}"
													  CommandParameter="{Binding}"
													  IsVisible="{Binding IsOwnMessage}"/>
										</ContextMenu>
									</Border.ContextMenu>
									<StackPanel>
										<TextBlock Text="{Binding Sender}" FontWeight="Bold"
                                                   Foreground="{Binding IsOwnMessage, Converter={StaticResource SenderColorConverter}}"/>
										<TextBlock Text="{Binding Content}" TextWrapping="Wrap"/>
										<TextBlock Text="{Binding Timestamp, StringFormat='HH:mm'}"
                                                   FontSize="10" HorizontalAlignment="Right"/>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>

				<!-- Поле для ввода сообщений -->
				<Grid Grid.Row="1" Margin="5">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>
					<TextBox Text="{Binding MessageText}" Watermark="Type your message here..."
                             AcceptsReturn="True" VerticalAlignment="Center"/>
					<Button Grid.Column="1" Content="Send" Margin="5,0,0,0"
                            Command="{Binding SendMessageCommand}" Width="80"/>
				</Grid>
			</Grid>
		</Grid>

		<!-- Панель со статусом -->
		<Border Grid.Row="2" Background="#e0e0e0" Padding="5">
			<TextBlock Text="{Binding StatusMessage}"/>
		</Border>
	</Grid>
</Window>